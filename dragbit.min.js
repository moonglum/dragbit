(function(e){var a,f,c;c={fairlyHighZIndex:"10",setup:function(b,a){b.css("position","absolute");b.data("shadowMode",a.shadowMode);b.data("moveX",a.moveX);b.data("moveY",a.moveY);b.data("lockInContainer",a.lockInContainer);b.data("container",b.parent());a.handle.mousedown(function(a){c.startDragging(a,b)});b.bind("dragStart",a.dragStart);b.bind("dragging",a.dragging);b.bind("dragStop",a.dragStop)},addDocumentListeners:function(){document.addEventListener("selectstart",c.cancelDocumentSelection);document.addEventListener("mousemove",
c.continueDragging);document.addEventListener("mouseup",c.stopDragging)},removeDocumentListeners:function(){document.removeEventListener("selectstart",c.cancelDocumentSelection);document.removeEventListener("mousemove",c.continueDragging);document.removeEventListener("mouseup",c.stopDragging)},startDragging:function(b,d){var i=d.position();d.data("shadowMode")&&(console.log("activated shadow mode"),f=d.clone(),d.after(f),f.css("opacity",0.3));d.prependTo(e("body"));d.css("top",i.top);d.css("left",
i.left);c.bringToFront(d);a=d;c.moveCurrentElement(b,a.position());c.addDocumentListeners();a.trigger("dragStart",a.position())},continueDragging:function(b){c.moveCurrentElement(b,c.calculateNewPosition(b));a.trigger("dragging",a.position())},stopDragging:function(){a.data("shadowMode")&&f.remove();a.data("lockInContainer")&&a.data("container").append(a);c.removeDocumentListeners();a.trigger("dragStop",a.position())},bringToFront:function(b){a&&a.css("z-index",c.fairlyHighZIndex-1);b.css("z-index",
c.fairlyHighZIndex)},moveCurrentElement:function(b,d){if(!a.data("lockInContainer")||c.checkBoundaries(d))a.data("moveX")&&(a.css("left",d.left),a.data("lastXPosition",b.clientX)),a.data("moveY")&&(a.css("top",d.top),a.data("lastYPosition",b.clientY))},checkBoundaries:function(b){var d=!0,c=a.data("container"),f=c.position().top,e=c.position().left,g=parseInt(c.css("width"),10),g=e+g,h=parseInt(c.css("height"),10),c=c.position().top+h,h=b.top,b=b.left,j=parseInt(a.css("width"),10),l=b+j,k=parseInt(a.css("height"),
10),m=h+k;f>h&&(a.css("top",f+1),d=!1);e>b&&(a.css("left",e+1),d=!1);g<l&&(a.css("left",g-j-1),d=!1);c<m&&(a.css("top",c-k-1),d=!1);return d},calculateNewPosition:function(b){var c=parseInt(a.css("left"),10),e=parseInt(a.css("top"),10);return{left:c+(b.clientX-a.data("lastXPosition")),top:e+(b.clientY-a.data("lastYPosition"))}},cancelDocumentSelection:function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();return a.returnValue=!1}};e.fn.draggable=function(a){a=e.extend({handle:this,
dragStart:function(){},dragging:function(){},dragStop:function(){},shadowMode:!1,moveX:!0,moveY:!0,lockInContainer:!1},a);c.setup(this,a);return this}})(jQuery);
