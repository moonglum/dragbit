(function(f){var a,e,c;c={fairlyHighZIndex:"10",setup:function(b,a){b.css("position","absolute");b.css("left",a.originalPosition.left);b.css("top",a.originalPosition.top);b.data("shadowMode",a.shadowMode);b.data("moveX",a.moveX);b.data("moveY",a.moveY);b.data("lockInContainer",a.lockInContainer);b.data("container",b.parent());a.handle.mousedown(function(a){1===a.which&&c.startDragging(a,b)});b.bind("dragStart",a.dragStart);b.bind("dragging",a.dragging);b.bind("dragStop",a.dragStop)},addDocumentListeners:function(){document.addEventListener("selectstart",
c.cancelDocumentSelection);document.addEventListener("mousemove",c.continueDragging);document.addEventListener("mouseup",c.stopDragging)},removeDocumentListeners:function(){document.removeEventListener("selectstart",c.cancelDocumentSelection);document.removeEventListener("mousemove",c.continueDragging);document.removeEventListener("mouseup",c.stopDragging)},startDragging:function(b,d){var j=d.offset();d.data("shadowMode")&&(e=d.clone(),d.after(e),e.css("opacity",0.3));d.prependTo(f("body"));d.css("top",
j.top);d.css("left",j.left);c.bringToFront(d);a=d;c.moveCurrentElement(b,a.offset());c.addDocumentListeners();a.trigger("dragStart",a.offset())},continueDragging:function(b){c.moveCurrentElement(b,c.calculateNewPosition(b));a.trigger("dragging",a.offset())},stopDragging:function(){a.data("shadowMode")&&e.remove();if(a.data("lockInContainer")){var b=a.offset();a.data("container").append(a);a.css("left",b.left-a.data("container").offset().left);a.css("top",b.top-a.data("container").offset().top)}c.removeDocumentListeners();
a.trigger("dragStop",a.offset())},bringToFront:function(b){a&&a.css("z-index",c.fairlyHighZIndex-1);b.css("z-index",c.fairlyHighZIndex)},moveCurrentElement:function(b,d){window.getSelection().removeAllRanges();if(!a.data("lockInContainer")||c.checkBoundaries(d))a.data("moveX")&&(a.css("left",d.left),a.data("lastXPosition",b.clientX)),a.data("moveY")&&(a.css("top",d.top),a.data("lastYPosition",b.clientY))},checkBoundaries:function(b){var d=!0,c=a.data("container"),f=c.offset().top,e=c.offset().left,
g=parseInt(c.css("width"),10),g=e+g,h=parseInt(c.css("height"),10),c=c.offset().top+h,h=b.top;b=b.left;var k=parseInt(a.css("width"),10),m=b+k,l=parseInt(a.css("height"),10),n=h+l;f>h&&(a.css("top",f+1),d=!1);e>b&&(a.css("left",e+1),d=!1);g<m&&(a.css("left",g-k-1),d=!1);c<n&&(a.css("top",c-l-1),d=!1);return d},calculateNewPosition:function(b){var c=parseInt(a.css("left"),10),e=parseInt(a.css("top"),10);return{left:c+(b.clientX-a.data("lastXPosition")),top:e+(b.clientY-a.data("lastYPosition"))}},cancelDocumentSelection:function(a){a.preventDefault&&
a.preventDefault();a.stopPropagation&&a.stopPropagation();return a.returnValue=!1}};f.fn.draggable=function(a){this.each(function(){var d=f(this),e=f.extend({handle:d,dragStart:function(){},dragging:function(){},dragStop:function(){},shadowMode:!1,moveX:!0,moveY:!0,lockInContainer:!1,originalPosition:d.position()},a);setTimeout(function(){c.setup(d,e)},100)});return this}})(jQuery);
